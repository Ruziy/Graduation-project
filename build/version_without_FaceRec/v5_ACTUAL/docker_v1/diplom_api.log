+ micromamba run -n diplom python -m pip install --no-cache-dir ultralytics==8.3.116 insightface==0.7.3 scikit-image==0.25.2 onnx==1.17.0 onnxruntime==1.22.0 face-detection==0.2.2 starlette>=0.40,<0.47
Collecting ultralytics==8.3.116
  Downloading ultralytics-8.3.116-py3-none-any.whl.metadata (37 kB)
Collecting insightface==0.7.3
  Downloading insightface-0.7.3.tar.gz (439 kB)
  Installing build dependencies: started
  Installing build dependencies: finished with status 'done'
  Getting requirements to build wheel: started
  Getting requirements to build wheel: finished with status 'done'
  Preparing metadata (pyproject.toml): started
  Preparing metadata (pyproject.toml): finished with status 'done'
Collecting scikit-image==0.25.2
  Downloading scikit_image-0.25.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (14 kB)
Requirement already satisfied: onnx==1.17.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (1.17.0)
Requirement already satisfied: onnxruntime==1.22.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (1.22.0)
Collecting face-detection==0.2.2
  Downloading face_detection-0.2.2.tar.gz (20 kB)
  Preparing metadata (setup.py): started
  Preparing metadata (setup.py): finished with status 'done'
Requirement already satisfied: starlette<0.47,>=0.40 in /opt/conda/envs/diplom/lib/python3.10/site-packages (0.46.2)
Requirement already satisfied: numpy<=2.1.1,>=1.23.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (1.26.4)
Requirement already satisfied: matplotlib>=3.3.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (3.10.1)
Requirement already satisfied: opencv-python>=4.6.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (4.11.0.86)
Requirement already satisfied: pillow>=7.1.2 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (10.2.0)
Requirement already satisfied: pyyaml>=5.3.1 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (6.0.3)
Requirement already satisfied: requests>=2.23.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (2.32.5)
Requirement already satisfied: scipy>=1.4.1 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (1.15.3)
Requirement already satisfied: torch>=1.8.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (2.2.2+cpu)
Requirement already satisfied: torchvision>=0.9.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (0.17.2+cpu)
Requirement already satisfied: tqdm>=4.64.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (4.67.1)
Requirement already satisfied: psutil in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (7.1.0)
Collecting py-cpuinfo (from ultralytics==8.3.116)
  Downloading py_cpuinfo-9.0.0-py3-none-any.whl.metadata (794 bytes)
Requirement already satisfied: pandas>=1.1.4 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (2.3.2)
Requirement already satisfied: seaborn>=0.11.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from ultralytics==8.3.116) (0.13.2)
Collecting ultralytics-thop>=2.0.0 (from ultralytics==8.3.116)
  Downloading ultralytics_thop-2.0.17-py3-none-any.whl.metadata (14 kB)
Requirement already satisfied: scikit-learn in /opt/conda/envs/diplom/lib/python3.10/site-packages (from insightface==0.7.3) (1.7.2)
Collecting easydict (from insightface==0.7.3)
  Downloading easydict-1.13-py3-none-any.whl.metadata (4.2 kB)
Collecting cython (from insightface==0.7.3)
  Downloading cython-3.1.4-cp310-cp310-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (5.0 kB)
Requirement already satisfied: albumentations in /opt/conda/envs/diplom/lib/python3.10/site-packages (from insightface==0.7.3) (2.0.8)
Requirement already satisfied: prettytable in /opt/conda/envs/diplom/lib/python3.10/site-packages (from insightface==0.7.3) (3.16.0)
Requirement already satisfied: networkx>=3.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from scikit-image==0.25.2) (3.4.2)
Collecting imageio!=2.35.0,>=2.33 (from scikit-image==0.25.2)
  Downloading imageio-2.37.0-py3-none-any.whl.metadata (5.2 kB)
Collecting tifffile>=2022.8.12 (from scikit-image==0.25.2)
  Downloading tifffile-2025.5.10-py3-none-any.whl.metadata (31 kB)
Requirement already satisfied: packaging>=21 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from scikit-image==0.25.2) (25.0)
Collecting lazy-loader>=0.4 (from scikit-image==0.25.2)
  Downloading lazy_loader-0.4-py3-none-any.whl.metadata (7.6 kB)
Requirement already satisfied: protobuf>=3.20.2 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from onnx==1.17.0) (6.32.1)
Requirement already satisfied: coloredlogs in /opt/conda/envs/diplom/lib/python3.10/site-packages (from onnxruntime==1.22.0) (15.0.1)
Requirement already satisfied: flatbuffers in /opt/conda/envs/diplom/lib/python3.10/site-packages (from onnxruntime==1.22.0) (25.9.23)
Requirement already satisfied: sympy in /opt/conda/envs/diplom/lib/python3.10/site-packages (from onnxruntime==1.22.0) (1.14.0)
Requirement already satisfied: anyio<5,>=3.6.2 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from starlette<0.47,>=0.40) (4.10.0)
Requirement already satisfied: exceptiongroup>=1.0.2 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from anyio<5,>=3.6.2->starlette<0.47,>=0.40) (1.3.0)
Requirement already satisfied: idna>=2.8 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from anyio<5,>=3.6.2->starlette<0.47,>=0.40) (3.10)
Requirement already satisfied: sniffio>=1.1 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from anyio<5,>=3.6.2->starlette<0.47,>=0.40) (1.3.1)
Requirement already satisfied: typing_extensions>=4.5 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from anyio<5,>=3.6.2->starlette<0.47,>=0.40) (4.15.0)
Requirement already satisfied: contourpy>=1.0.1 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from matplotlib>=3.3.0->ultralytics==8.3.116) (1.3.2)
Requirement already satisfied: cycler>=0.10 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from matplotlib>=3.3.0->ultralytics==8.3.116) (0.12.1)
Requirement already satisfied: fonttools>=4.22.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from matplotlib>=3.3.0->ultralytics==8.3.116) (4.60.0)
Requirement already satisfied: kiwisolver>=1.3.1 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from matplotlib>=3.3.0->ultralytics==8.3.116) (1.4.9)
Requirement already satisfied: pyparsing>=2.3.1 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from matplotlib>=3.3.0->ultralytics==8.3.116) (3.2.5)
Requirement already satisfied: python-dateutil>=2.7 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from matplotlib>=3.3.0->ultralytics==8.3.116) (2.9.0.post0)
Requirement already satisfied: pytz>=2020.1 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from pandas>=1.1.4->ultralytics==8.3.116) (2025.2)
Requirement already satisfied: tzdata>=2022.7 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from pandas>=1.1.4->ultralytics==8.3.116) (2025.2)
Requirement already satisfied: six>=1.5 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from python-dateutil>=2.7->matplotlib>=3.3.0->ultralytics==8.3.116) (1.17.0)
Requirement already satisfied: charset_normalizer<4,>=2 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from requests>=2.23.0->ultralytics==8.3.116) (3.4.3)
Requirement already satisfied: urllib3<3,>=1.21.1 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from requests>=2.23.0->ultralytics==8.3.116) (2.5.0)
Requirement already satisfied: certifi>=2017.4.17 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from requests>=2.23.0->ultralytics==8.3.116) (2025.8.3)
Requirement already satisfied: filelock in /opt/conda/envs/diplom/lib/python3.10/site-packages (from torch>=1.8.0->ultralytics==8.3.116) (3.19.1)
Requirement already satisfied: jinja2 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from torch>=1.8.0->ultralytics==8.3.116) (3.1.6)
Requirement already satisfied: fsspec in /opt/conda/envs/diplom/lib/python3.10/site-packages (from torch>=1.8.0->ultralytics==8.3.116) (2025.9.0)
Requirement already satisfied: pydantic>=2.9.2 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from albumentations->insightface==0.7.3) (2.11.9)
Requirement already satisfied: albucore==0.0.24 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from albumentations->insightface==0.7.3) (0.0.24)
Requirement already satisfied: opencv-python-headless>=4.9.0.80 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from albumentations->insightface==0.7.3) (4.11.0.86)
Requirement already satisfied: stringzilla>=3.10.4 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from albucore==0.0.24->albumentations->insightface==0.7.3) (4.0.13)
Requirement already satisfied: simsimd>=5.9.2 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from albucore==0.0.24->albumentations->insightface==0.7.3) (6.5.3)
Requirement already satisfied: annotated-types>=0.6.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from pydantic>=2.9.2->albumentations->insightface==0.7.3) (0.7.0)
Requirement already satisfied: pydantic-core==2.33.2 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from pydantic>=2.9.2->albumentations->insightface==0.7.3) (2.33.2)
Requirement already satisfied: typing-inspection>=0.4.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from pydantic>=2.9.2->albumentations->insightface==0.7.3) (0.4.1)
Requirement already satisfied: humanfriendly>=9.1 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from coloredlogs->onnxruntime==1.22.0) (10.0)
Requirement already satisfied: MarkupSafe>=2.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from jinja2->torch>=1.8.0->ultralytics==8.3.116) (3.0.3)
Requirement already satisfied: wcwidth in /opt/conda/envs/diplom/lib/python3.10/site-packages (from prettytable->insightface==0.7.3) (0.2.13)
Requirement already satisfied: joblib>=1.2.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from scikit-learn->insightface==0.7.3) (1.5.2)
Requirement already satisfied: threadpoolctl>=3.1.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from scikit-learn->insightface==0.7.3) (3.6.0)
Requirement already satisfied: mpmath<1.4,>=1.1.0 in /opt/conda/envs/diplom/lib/python3.10/site-packages (from sympy->onnxruntime==1.22.0) (1.3.0)
Downloading ultralytics-8.3.116-py3-none-any.whl (984 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 984.0/984.0 kB 9.8 MB/s  0:00:00
Downloading scikit_image-0.25.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (14.8 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 14.8/14.8 MB 21.2 MB/s  0:00:00
Downloading imageio-2.37.0-py3-none-any.whl (315 kB)
Downloading lazy_loader-0.4-py3-none-any.whl (12 kB)
Downloading tifffile-2025.5.10-py3-none-any.whl (226 kB)
Downloading ultralytics_thop-2.0.17-py3-none-any.whl (28 kB)
Downloading cython-3.1.4-cp310-cp310-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (3.4 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 3.4/3.4 MB 45.8 MB/s  0:00:00
Downloading easydict-1.13-py3-none-any.whl (6.8 kB)
Downloading py_cpuinfo-9.0.0-py3-none-any.whl (22 kB)
Building wheels for collected packages: insightface, face-detection
  Building wheel for insightface (pyproject.toml): started
  Building wheel for insightface (pyproject.toml): finished with status 'done'
  Created wheel for insightface: filename=insightface-0.7.3-cp310-cp310-linux_x86_64.whl size=878687 sha256=f6ba9849bf5feca4dda23293cfb6434b5c56275dcfdd362dd73fe3ca0441339a
  Stored in directory: /tmp/pip-ephem-wheel-cache-ann0on87/wheels/e3/d0/80/e3773fb8b6d1cca87ea1d33d9b1f20a223a6493c896da249b5
  DEPRECATION: Building 'face-detection' using the legacy setup.py bdist_wheel mechanism, which will be removed in a future version. pip 25.3 will enforce this behaviour change. A possible replacement is to use the standardized build interface by setting the `--use-pep517` option, (possibly combined with `--no-build-isolation`), or adding a `pyproject.toml` file to the source tree of 'face-detection'. Discussion can be found at https://github.com/pypa/pip/issues/6334
  Building wheel for face-detection (setup.py): started
  Building wheel for face-detection (setup.py): finished with status 'done'
  Created wheel for face-detection: filename=face_detection-0.2.2-py3-none-any.whl size=25610 sha256=fec96f4a1f2f7da58403532eaee4286fe76fb77d8f0d330795562517ae2b2645
  Stored in directory: /tmp/pip-ephem-wheel-cache-ann0on87/wheels/f9/14/a1/617e184738e71e46c1e75f068f67a911917ae5d02faeabc4e4
Successfully built insightface face-detection
Installing collected packages: py-cpuinfo, easydict, tifffile, lazy-loader, imageio, cython, scikit-image, ultralytics-thop, ultralytics, insightface, face-detection

Successfully installed cython-3.1.4 easydict-1.13 face-detection-0.2.2 imageio-2.37.0 insightface-0.7.3 lazy-loader-0.4 py-cpuinfo-9.0.0 scikit-image-0.25.2 tifffile-2025.5.10 ultralytics-8.3.116 ultralytics-thop-2.0.17
+ micromamba run -n diplom python -
[ WARN:0@0.049] global cap_v4l.cpp:913 open VIDEOIO(V4L2:/dev/video0): can't open camera by index
[ERROR:0@0.049] global obsensor_uvc_stream_channel.cpp:158 getStreamChannelGroup Camera index out of range
CAM_URL: 0
cv2.opened: False
+ exec micromamba run -n diplom uvicorn gateway:app --host 0.0.0.0 --port 8000 --app-dir /app/unified_api
Creating new Ultralytics Settings v0.0.6 file ✅ 
View Ultralytics Settings with 'yolo settings' or at '/home/mambauser/.config/Ultralytics/settings.json'
Update Settings with 'yolo settings key=value', i.e. 'yolo settings runs_dir=path/to/dir'. For help see https://docs.ultralytics.com/quickstart/#ultralytics-settings.
INFO:     Started server process [111]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     172.17.0.1:43802 - "GET / HTTP/1.1" 200 OK
INFO:     172.17.0.1:43802 - "GET /favicon.ico HTTP/1.1" 204 No Content
INFO:     172.17.0.1:43802 - "GET /optimizer/ HTTP/1.1" 200 OK
INFO:     172.17.0.1:43802 - "GET /favicon.ico HTTP/1.1" 204 No Content
INFO:     172.17.0.1:43802 - "POST /optimizer/run-mode-ui HTTP/1.1" 200 OK
INFO:     172.17.0.1:43802 - "GET /favicon.ico HTTP/1.1" 204 No Content
